"use strict";(()=>{const c="runtime-v1",f="static-v1",d="cache-timestamp",v=["/en/~offline","/sv/~offline","/web-app-manifest-192x192.png"],w=new RegExp(["/screenshots.*","/__nextjs_original-stack-frame.*","%2Fmedieteknik-static%2Fprofile.*","%2Fmedieteknik-static%2Fnews.*","%2Fi.ytimg.com%2Fvi.*","vercel.*","_vercel.*"].join("|")),m="X-Time-Cache",y=60*60*24*30;let g=0;async function u(){const t=Date.now();if(!(t-g<24*60*60*1e3)){g=t;try{const e=await caches.open(c);if(!e)return;const n=await e.match(d);if(!n)return;const l=Number.parseInt(await n.text(),10);if(Math.floor((t-l)/(1e3*60*60*24))<30)return;const i=await e.keys();for(const r of i){const s=await e.match(r);if(!s)continue;const o=s.headers.get(m);if(!o)continue;t-Number.parseInt(o,10)>y&&await e.delete(r)}const a=new Response(t.toString());await e.put(d,a)}catch(e){console.error("[Service Worker] Error cleaning up expired cache:",e)}}}self.addEventListener("install",t=>{self.skipWaiting(),t.waitUntil(Promise.all([caches.open(f).then(e=>e.addAll(v)),caches.open(c).then(e=>e.put(d,new Response(Date.now().toString())))]))});self.addEventListener("activate",t=>{t.waitUntil(Promise.all([caches.keys().then(e=>Promise.all(e.map(n=>{if(![f,c].includes(n))return caches.delete(n)}))).then(()=>self.clients.claim()),u(),self.clients.claim()])),t.waitUntil(self.clients.claim())});self.addEventListener("periodicsync",t=>{t.tag==="cleanup-cache"&&t.waitUntil(u())});self.addEventListener("message",t=>{if(t.data&&t.data.type==="REGISTER_PERIODIC_SYNC"){if(!("periodicSync"in self.registration)){console.warn("[Service Worker] Periodic sync is not supported in this browser.");return}self.registration.periodicSync.register("cleanup-cache",{minInterval:24*60*60*1e3}).catch(e=>{console.error("[Service Worker] Periodic sync registration failed (Are you using the PWA mode?):",e)})}});self.addEventListener("push",t=>{if(Notification.permission!=="granted"||!t.data)return;const e={title:"New Notification",body:"Default message",icon:"/web-app-manifest-192x192-maskable.png",badge:"/web-app-manifest-192x192-maskable.png",tag:"notification-tag",requireInteraction:!1,vibrate:[200,100,200],data:{dateOfArrival:Date.now(),primaryKey:"1",url:"https://www.google.com"}};try{const n=t.data.json();e.body=n.body||e.body,e.title=n.title||"New Notification",e.tag=n.tag||e.tag,e.data={dateOfArrival:n.data?.dateOfArrival||Date.now(),primaryKey:n.data?.primaryKey||"1",url:n.url||e.data?.url}}catch(n){console.warn("[Service Worker] Error parsing push data:",n)}t.waitUntil(self.registration.showNotification(e.title||"New Notification",e))});self.addEventListener("notificationclick",t=>{if(t.notification.close(),t.notification.data?.url){const e=new URL(t.notification.data.url);t.waitUntil(clients.openWindow(e.href));return}t.waitUntil(clients.openWindow("https://www.google.com"))});function S(t,e){return!(!t||t.status!==200||t.type!=="basic"||!e.url.startsWith("http")||e.url.includes("/api/")||e.method!=="GET"||w.test(e.url))}function k(t){const e=new URL(t.url);if(e.pathname.endsWith("/script.js")||e.pathname.includes("/_vercel/insights/"))return!0;const n=t.headers.get("Cache-Control");return!!(n&&(n.includes("no-store")||n.includes("immutable")||n.includes("max-age=31536000")))}async function D(t){return caches.match(`/${t}/~offline`).then(e=>e||new Response("Offline",{status:503,statusText:"Service Unavailable",headers:new Headers({"Content-Type":"text/plain"})})).catch(()=>new Response("Offline",{status:503,statusText:"Service Unavailable",headers:new Headers({"Content-Type":"text/plain"})}))}self.addEventListener("fetch",t=>{const e=t.request;u();const n=new URL(e.url);if(k(e))return;const l=/\.(woff2|woff|ttf)$/.test(n.pathname),p=n.pathname.includes("medieteknik-static%2Fstatic")||n.pathname.endsWith("manifest.webmanifest")||n.pathname.endsWith("web-app-manifest-192x192.png");if(l||p){t.respondWith(caches.open(f).then(async i=>i.match(e).then(a=>{const r=fetch(e).then(s=>(i.put(e,s.clone()),s));return a||r})));return}t.respondWith(fetch(e).then(i=>{if(S(i,e)){let a=e;n.search.includes("?_rsc")&&(a=new Request(n.href.replace(n.search,"")));const r=i.clone();if(e.method!=="GET")return i;const s=new Headers(r.headers);s.append(m,Date.now().toString()),r.blob().then(o=>{const h=new Response(o,{status:r.status,statusText:r.statusText,headers:s});caches.open(c).then(E=>{E.put(a,h.clone())})})}return i}).catch(async()=>{let i=e;n.search.includes("?_rsc")&&(i=new Request(n.href.replace(n.search,"")));const a=await caches.match(i);if(a)return a;const r=n.pathname.startsWith("/sv")?"sv":"en";return D(r)}))});self.addEventListener("error",t=>console.error("[Service Worker] Error:",t.error));self.addEventListener("unhandledrejection",t=>console.error("[Service Worker] Unhandled promise rejection:",t.reason));})();
